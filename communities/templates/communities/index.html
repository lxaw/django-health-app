{% extends "core/base.html" %}

{% block content %}

<div class = "container border border-primary rounded p-3">
	<h1 class = 'text-center'>
		Communities
	</h1>
</div>

<br>

{% if user.is_pod_plus_member %}
<div class = "container border rounded p-3">
	<div class = "d-flex flex-row justify-content-center">
		<i class="bi bi-star mr-3 mt-1"></i>
		<a href = "{% url 'communities:leaderboard-index' %}">
			<h4 class = "text-center">
				Community Leaderboard (POD+ Exclusive)
			</h4>
		</a>
		<i class="bi bi-star ml-3 mt-1"></i>
	</div>
</div>
{% endif %}

<br>

<div class = "container border rounded p-3">
	<a href = "{% url 'communities:post-prepare' %}">
		<h4 class ="text-center">
			Create a post.
		</h4>
	</a>
</div>

<br>

<div class = "container border border rounded p-3">
	<div>
		<h4 class = "text-center">Recent posts:</h4>
	</div>
	
	<div class = "container" id = "div__posts-container" >
		{% include 'communities/t/posts.html' %}
	</div>

	<br>


</div>

<br>

<div class = 'container'>
	<ul class='pagination justify-content-center'>
	{% if qsPosts.has_previous %}
		<li class="mx-1">
			<p page='{{qsPosts.previous_page_number}}' data-url = '{% url "communities:index" qsPosts.previous_page_number %}' onclick = "ajax_update_url(this)">
				Previous
			</p>
		</li>
	{% else %}
		<li class='mx-1 disabled'><span >Previous</span></li>
	{% endif %}

	{% for i in qsPosts.paginator.page_range %}
		{% if qsPosts.number == i %}
		<li class='active mx-1'><span>{{ i }}</span></li>
		{% else %}
		<li class="mx-1">
			<a href='{% url "communities:index" i %}'>{{ i }}</a>
		</li>
		{% endif %}
	{% endfor %}
	
	{% if qsPosts.has_next %}
		<li class="mx-1"><a href='{% url "communities:index" qsPosts.next_page_number %}' >Next</a></li>
	{% else %}
		<li class="mx-1"><span class='disabled'>Next</span></li> 
	{% endif %}
	</ul>
</div>

{% include 'communities/t/jPostActions.html' %}

{% endblock content %}

{% block javascript %}

<script>

function ajax_update_url(e){
	page = e.getAttribute("page");
	strUrl = e.getAttribute("data-url");
	let divPostContainer = document.getElementById('div__posts-container');

	$.ajax({
		type: 'GET',
		url: strUrl,
		dataType:'json',
		data:{
			'page':page
		},
		success:function(data){
			// reload posts
			divPostContainer.innerHTML = data.posts_html;
		},

	})
}

</script>

{% endblock %}
