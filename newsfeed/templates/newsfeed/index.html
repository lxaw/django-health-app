{% extends "core/base.html" %}

{% block content %}

<div class = "container text-center border border-primary rounded p-3">
	<h1>Here is your newsfeed.</h1>
</div>

<br>

<div class = "container border border-primary rounded p-3">
	<h1 class = "text-center">
		<a href = "{% url 'newsfeed:request_help' %}">
			Request help.
		</a>
	</h1>
</div>

<br>

<div class = "container border border-primary rounded p-3">
	<h4>
		Recent Help Requests
	</h4>
	{% for modelHelpRequest in listUnfilledHelpRequests %}

		<div class = "container border border-primary rounded">
			<br>
			<a href = "{% url 'communities:profile' modelHelpRequest.author.username %}">
				<img alt = "a profile picture" style="height:10%;width:10%"  class = "rounded-circle img__users-profile-img border border-dark" src = "{{modelHelpRequest.author.profile_picture.url}}">
					{{modelHelpRequest.author}}
			</a> on {{modelHelpRequest.pub_date}}
			<br>
			<br>
			<div class  ="container">
				<a href = "{{modelHelpRequest.get_absolute_url}}" style="text-decoration: none;">
					<div class = "container row">
						<p>Title: </p>
						<strong>
							"{{modelHelpRequest.title}}"
						</strong>
					</div>
				</a>
			</div>
			<div class = "container">
				<p>Related tags:</p>
				{% for strTag in modelHelpRequest.get_parsed_tags %}
					<span style= "background-color: aliceblue;" class ="rounded mr-3 p-1">
						<a href = "{% url 'newsfeed:detail_tag' strTag %}" style = "text-decoration: none;">
							{{strTag}}
						</a>
					</span>
				{% endfor %}
			</div>
			<br>
			{% if request.user == modelHelpRequest.author %}
				<p data-url = "{% url 'newsfeed:delete_help_request' modelHelpRequest.id %}" class = "p__delete-help-request mr-4 text-danger">
					Delete?
				</p>
			{% endif %}
		</div>
		<br>

	{% endfor %}
</div>

<br>

<div class = "container border border-primary rounded">
	<h4>
		See what your followed users are posting.
	</h4>
	{% if listLastNFollowedUserPosts|length == 0 %}
		<p>Looks like theres nothing yet!</p>
	{% else %}
		{% for modelPost in listLastNFollowedUserPosts %}
			<div class = "newsfeed__new-post border border-primary" style="width: 50%;padding:10px;border-radius: 5px;margin-bottom:10px;">
				<a href = "{{modelPost.get_absolute_url}}">
					User  {{modelPost.author}} uploaded a post at {{modelPost.pub_date}}
				</a>
			</div>
		{% endfor %}
	{% endif %}
</div>

<br>

<div class = "container border border-primary rounded">
	<h4>
		Most recent posts today.
	</h4>
	{% if listRecentPost|length == 0 %}
		<p>Looks like theres nothing yet!</p>
	{% endif %}
	{% for modelPost in listRecentPosts %}

		<div class = "newsfeed__new-post border border-primary" style="width: 50%;padding:10px;border-radius: 5px;margin-bottom:10px;">
			<a href = "{{modelPost.get_absolute_url}}">
				User  {{modelPost.author}} uploaded a post at {{modelPost.pub_date}}
			</a>
		</div>

	{% endfor %}
</div>


{% endblock content %}


{% block javascript %}

<script>
	/*
	************************
	* Functions
	************************
	*/
	function delete_help_request(strUrl){

		$.ajax({
			url:strUrl,
			success:function(){
				location.reload();
			}
		})
	}
	
	// associate p with delete request
	let arrPDeleteHelpRequest = document.getElementsByClassName("p__delete-help-request");
	for(let p of arrPDeleteHelpRequest){
		p.addEventListener('click',()=>{
			delete_help_request(p.getAttribute('data-url'));
		})
	}

</script>

{% endblock javascript %}