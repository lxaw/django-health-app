{% extends 'core/base.html' %}


{% block content %}

<div style="align-items:flex-start;" class = "container border rounded p-3">
	<div style="display:inline-flex" >
		<img class = "rounded-circle img__users-profile-img" src = "{{user.profile_picture.url}}">
		<div class = "div__users-profile-media-account">
			<h2 class = "account-heading">
				Welcome,  <strong>{{user.username}}.</strong>
			</h2>
			{% if user.is_pod_plus_member %}
				<p class = "text-secondary">POD+ Member</p>
			{% endif %}
		</div>
	</div>
</div>

<br>


<br>

<div class = "container border border-primary rounded p-3">
	<div class = "row">
		<div class = "col-sm col-md-4">
			<h2>Your information:</h2>
			<strong>Email:</strong> {{dictUserStats.strEmail}}
			<br>
			<strong>Username:</strong> {{dictUserStats.strUsername}}
			<br>
			<strong>Days Active:</strong> {{dictUserStats.intDaysActive}}
			<br>
			<strong>Points:</strong> {{dictUserStats.intPoints}}
			<br>
			<strong>Date joined:</strong>{{dictUserStats.strDateJoined}}
		</div>
		<div class = "col-sm col-md-4">
			<h2>Your Diet Stats:</h2>
			<strong>Standard Deviation: </strong>{{dictUserStats.floatStd}}
			<br>
			<strong>Mean: </strong>{{dictUserStats.floatMean}}
			<br>
			<strong>Median: </strong>{{dictUserStats.floatMedian}}
			<br>
		</div>
		<div class = "col-sm col-md-4">
			<h2>Your Physical Activity</h2>

		</div>
	</div>
</div>

<br>
<br>

<div class = "container border border-primary rounded p-3">
	<h2 class = "text-center">Your Graphs:</h2>
	<br>
	<div class = "row">
		<div class = "col-sm col-md-7">

		</div>
		<div class = "col-sm col-md-5">
			<!-- kcal info for grab by javascript -->
			{{listFood|json_script:"jsonFoods"}}
			<div class = "div__users-profile-chart-container">
				<canvas id = "canvas__users-profile-chart__id"></canvas>
			</div>
		</div>
	</div>
</div>

<br>

<div class = "container border border-primary rounded p-3 text-center">
	<a href = "{% url 'users:upload_food' %}">
		<h3>Upload your most recent meal.</h3>
	</a>
</div>

<br>

<div class = "container border border-primary rounded p-3">
	<div class = "container text-center">
		<h2>Your History:</h2>
	</div>
	{% for modelFood in setFood %}
		<div class = "container border rounded p-3">
			<p><strong>Meal name: </strong> {{modelFood.name}}</p>
			<p><strong>Date:</strong> {{modelFood.date}}</p>
			<p><strong>Kilocalorie count:</strong> {{modelFood.kcals}}</p>
			<p class = "p__delete-food text-danger" data-url="{% url 'users:delete_food' modelFood.id %}" >
				Delete?
			</a>
		</div>
		<br>
	{% endfor %}
</div>

<br>

<div class = "container border border-primary rounded pb-5 pt-1">
	<div class = "container p-3 text-center">
		<h4>Follow count {{user.follows.count}}</h4>
	</div>
	{% for modelUser in listFollowedUsers %}
		<div class = "border rounded p-3">
			<a href = "{{modelUser.get_public_profile_url}}">
				<img class = "rounded-circle img__users-profile-img" src = "{{modelUser.profile_picture.url}}">
				{{modelUser.username}}
			</a>
		</div>
	{% endfor %}
</div>


{% endblock %}

{% block javascript %}
<script>
/*
*************************
* For working with ajax
*************************
*/
function delete_food(strUrl){
	// confirm before
	if(!confirm("Are you sure?")){
		return;
	}

	$.ajax({
		url:strUrl,
		success:function(){
			location.reload()
		}
	})
}

let arrpDeleteFood = document.getElementsByClassName("p__delete-food");
for(let p of arrpDeleteFood){
	p.addEventListener("click",()=>{
		delete_food(p.getAttribute("data-url"));
	})
}


/*
*************************
* For working with graphs
*************************
*/
var arrFoods = JSON.parse(document.getElementById('jsonFoods').textContent);

var arrLabels = [];
var arrData = [];

// populate the arrays
for(let objFood of arrFoods){
	arrLabels.push(objFood.date);
	arrData.push(objFood.kcals);
}

var ctx = document.getElementById('canvas__users-profile-chart__id').getContext('2d');

var myChart = new Chart(ctx, {
    type: 'line',
    data: {
		labels: arrLabels,
        datasets: [{
            data: arrData,
			borderColor:'rgb(75,192,192)',
            borderWidth: 1,
			fill:false,
			tension:0.1
        }]
    },
    options: {
		maintainAspectRatio:false,
		responsive:true,
		legend:{
			display:false
		},
        scales: {
			yAxes: [{
				scaleLabel:{
					display:true,
					labelString:'K-Cal Count'
				}
			}],
			xAxes: [{
				scaleLabel:{
					display:true,
					labelString:'Day Number of Year'
				}
			}]
        }
    }
});

</script>
{% endblock javascript %}